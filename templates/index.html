<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare Translation Web App</title>
    <link rel="stylesheet" href="static/styles.css">
</head>
<body>
    <div class="container">
        <h1>Healthcare Translation</h1>
        <form id="translation-form">
            <textarea id="text-input" placeholder="Enter text for translation..." required></textarea><br>
            <label for="input-language">Select input language:</label>
            <select id="input-language">
                <option value="en">English</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
                <!-- Add more languages if needed -->
            </select><br><br>

            <label for="output-language">Select output language:</label>
            <select id="output-language">
                <option value="en">English</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
                <!-- Add more languages if needed -->
            </select><br><br>

            <button type="submit">Translate</button>
        </form>

        <h2>Translated Text:</h2>
        <div id="translated-text"></div><br>

        <button id="speak-btn" disabled>Speak</button><br>

        <audio id="audio-output" controls style="display:none;">
            <source id="audio-source" src="" type="audio/mp3">
            Your browser does not support the audio element.
        </audio>
    </div>

    <script>
        const form = document.getElementById("translation-form");
        const translatedTextDiv = document.getElementById("translated-text");
        const speakButton = document.getElementById("speak-btn");
        const audioOutput = document.getElementById("audio-output");
        const audioSource = document.getElementById("audio-source");

        form.addEventListener("submit", async (event) => {
            event.preventDefault();

            const textInput = document.getElementById("text-input").value;
            const inputLanguage = document.getElementById("input-language").value;
            const outputLanguage = document.getElementById("output-language").value;

            // Translate text using the backend
            const response = await fetch("/translate", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    text: textInput,
                    input_language: inputLanguage,
                    output_language: outputLanguage
                })
            });

            const data = await response.json();

            if (data.translated_text) {
                // Display translated text
                translatedTextDiv.textContent = data.translated_text;
                speakButton.disabled = false;  // Enable the speak button
            } else {
                translatedTextDiv.textContent = "Translation failed. Please try again.";
                speakButton.disabled = true;
            }
        });

        speakButton.addEventListener("click", async () => {
            const translatedText = translatedTextDiv.textContent;

            // Send the translated text to the backend for TTS
            const response = await fetch("/speak", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    text: translatedText
                })
            });

            const data = await response.json();

            if (data.audio_url) {
                // Play the audio output
                audioSource.src = data.audio_url;
                audioOutput.style.display = "block";  // Show the audio player
                audioOutput.play();
            } else {
                alert("Error generating speech.");
            }
        });
    </script>
</body>
</html>
